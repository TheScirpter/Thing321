<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>N4S - Notes for Success</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f9f9f9;
    color: #202124;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .dark body {
    background: #121212;
    color: #e8eaed;
  }

  /* LOGIN SCREEN */
  #login-screen {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f9f9f9;
    color: #202124;
  }
  .dark #login-screen {
    background: #121212;
    color: #e8eaed;
  }
  .login-container {
    background: white;
    border-radius: 12px;
    padding: 40px 50px;
    box-shadow: 0 4px 18px rgb(0 0 0 / 0.1);
    text-align: center;
    width: 320px;
  }
  .dark .login-container {
    background: #1e1e1e;
    box-shadow: 0 4px 24px rgb(0 0 0 / 0.5);
  }
  .login-container h1 {
    font-weight: 800;
    font-size: 3rem;
    margin-bottom: 0;
    letter-spacing: 2px;
    color: #3b82f6;
  }
  .login-container .subtitle {
    margin-top: 4px;
    margin-bottom: 25px;
    font-weight: 500;
    color: #555;
  }
  .dark .login-container .subtitle {
    color: #bbb;
  }
  .login-container input {
    width: 100%;
    padding: 14px 15px;
    margin: 12px 0;
    border: 1.5px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
    outline-offset: 2px;
    transition: border-color 0.2s ease-in-out;
    background: #fff;
    color: #202124;
  }
  .dark .login-container input {
    background: #2a2a2a;
    color: #e8eaed;
    border-color: #555;
  }
  .login-container input:focus {
    border-color: #3b82f6;
  }
  .login-container button {
    width: 100%;
    padding: 14px 0;
    margin-top: 20px;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    background: #3b82f6;
    color: white;
    box-shadow: 0 4px 8px rgb(59 130 246 / 0.4);
    transition: background-color 0.2s ease-in-out;
  }
  .login-container button:hover {
    background: #2563eb;
  }
  .login-container .secondary-btn {
    margin-top: 12px;
    background: transparent;
    color: #3b82f6;
    box-shadow: none;
  }
  .login-container .secondary-btn:hover {
    text-decoration: underline;
    background: transparent;
  }
  .toggle-dark-btn {
    margin-top: 24px;
    font-size: 0.9rem;
    background: transparent;
    color: #3b82f6;
    border: none;
    cursor: pointer;
    font-weight: 600;
  }
  .toggle-dark-btn:hover {
    text-decoration: underline;
  }
  #login-message {
    margin-top: 12px;
    min-height: 1.3em;
    font-weight: 600;
    color: crimson;
  }

  /* MAIN APP */
  #app {
    display: none;
    flex-direction: column;
    height: 100%;
    flex: 1;
  }
  #header-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #3b82f6;
    color: white;
    padding: 10px 20px;
    font-weight: 700;
    font-size: 1.2em;
  }
  #header-bar button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
  }
  #app-container {
    display: flex;
    flex: 1;
    overflow: hidden;
  }
  #sidebar {
    width: 280px;
    background: #e8eaed;
    display: flex;
    flex-direction: column;
    border-right: 1px solid #ddd;
    overflow-y: auto;
  }
  .dark #sidebar {
    background: #1e1e1e;
    border-color: #333;
  }
  #sidebar-header {
    padding: 15px 20px;
    font-weight: 700;
    font-size: 1.1em;
    border-bottom: 1px solid #ddd;
  }
  .dark #sidebar-header {
    border-color: #333;
  }
  #notes-list {
    flex: 1;
    overflow-y: auto;
  }
  .note-item {
    padding: 10px 20px;
    cursor: pointer;
    border-bottom: 1px solid #ddd;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: background 0.15s ease;
    display: flex;
    align-items: center;
  }
  .dark .note-item {
    border-color: #333;
  }
  .note-item:hover {
    background: #d3e4ff;
  }
  .dark .note-item:hover {
    background: #2a2a2a;
  }
  .note-item.selected {
    background: #3b82f6;
    color: white;
  }
  .note-item .icon {
    margin-right: 8px;
    font-size: 1.1em;
  }
  #sidebar-buttons {
    padding: 10px 20px;
    border-top: 1px solid #ddd;
    display: flex;
    justify-content: center;
  }
  .dark #sidebar-buttons {
    border-color: #333;
  }
  #sidebar-buttons button {
    padding: 10px 20px;
    background: #3b82f6;
    border: none;
    border-radius: 4px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  #sidebar-buttons button:hover {
    background: #2563eb;
  }
  #editor {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px 25px;
    background: white;
    overflow-y: auto;
  }
  .dark #editor {
    background: #121212;
  }
  #note-title {
    font-size: 1.6em;
    font-weight: 700;
    border: none;
    outline: none;
    margin-bottom: 12px;
    background: transparent;
    color: inherit;
    border-bottom: 2px solid transparent;
    transition: border-color 0.25s ease;
  }
  #note-title:focus {
    border-color: #3b82f6;
  }
  #note-content {
    flex: 1;
    resize: none;
    border: none;
    outline: none;
    background: transparent;
    color: inherit;
    font-size: 1.1em;
    line-height: 1.6em;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  #note-content::placeholder {
    color: #888;
  }
  #save-status {
    height: 1.2em;
    color: #3b82f6;
    font-weight: 600;
    margin-top: 8px;
    font-size: 0.9em;
  }

  /* Scrollbar */
  #sidebar::-webkit-scrollbar,
  #notes-list::-webkit-scrollbar,
  #editor::-webkit-scrollbar {
    width: 8px;
  }
  #sidebar::-webkit-scrollbar-thumb,
  #notes-list::-webkit-scrollbar-thumb,
  #editor::-webkit-scrollbar-thumb {
    background: #bbb;
    border-radius: 4px;
  }
  .dark #sidebar::-webkit-scrollbar-thumb,
  .dark #notes-list::-webkit-scrollbar-thumb,
  .dark #editor::-webkit-scrollbar-thumb {
    background: #444;
  }

  /* Responsive */
  @media (max-width: 600px) {
    #app-container {
      flex-direction: column;
    }
    #sidebar {
      width: 100%;
      height: 180px;
      border-right: none;
      border-bottom: 1px solid #ddd;
      flex-shrink: 0;
    }
    #editor {
      flex: 1;
      height: auto;
    }
  }
</style>
</head>
<body>
<!-- LOGIN -->
<div id="login-screen">
  <div class="login-container">
    <h1>N4S</h1>
    <p class="subtitle">Notes for Success</p>
    <input id="email" type="email" placeholder="Email" autocomplete="username" />
    <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
    <button id="login-btn">Log In</button>
    <button id="signup-btn" class="secondary-btn">Sign Up</button>
    <button id="reset-btn" class="secondary-btn">Forgot Password?</button>
    <div id="login-message"></div>
    <button id="toggle-dark-btn" class="toggle-dark-btn">Toggle Dark Mode</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">
  <div id="header-bar">
    <div id="user-email"></div>
    <div>
      <button id="logout-btn" title="Log Out">Logout</button>
      <button id="toggle-dark-main-btn" title="Toggle Dark Mode">Dark Mode</button>
    </div>
  </div>
  <div id="app-container">
    <nav id="sidebar">
      <div id="sidebar-header">Your Notes</div>
      <div id="notes-list"></div>
      <div id="sidebar-buttons">
        <button id="new-note-btn" title="Create New Note">+ New Note</button>
      </div>
    </nav>
    <section id="editor">
      <input id="note-title" placeholder="Note Title" />
      <textarea id="note-content" placeholder="Start writing your note here..."></textarea>
      <div id="save-status"></div>
    </section>
  </div>
</div>

<script>
  // Your Firebase config from your project setup
  const firebaseConfig = {
    apiKey: "AIzaSyB7FM1PA0TwtBuHjnXDXVUOkZUnfU1dw3M",
    authDomain: "website-54b55.firebaseapp.com",
    projectId: "website-54b55",
    storageBucket: "website-54b55.appspot.com",
    messagingSenderId: "1077740411110",
    appId: "1:1077740411110:web:2c1d382199cbb445108327",
    measurementId: "G-JQSBZY3CH8"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Elements
  const loginScreen = document.getElementById('login-screen');
  const app = document.getElementById('app');
  const loginMessage = document.getElementById('login-message');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const loginBtn = document.getElementById('login-btn');
  const signupBtn = document.getElementById('signup-btn');
  const resetBtn = document.getElementById('reset-btn');
  const toggleDarkBtn = document.getElementById('toggle-dark-btn');
  const toggleDarkMainBtn = document.getElementById('toggle-dark-main-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const userEmailDisplay = document.getElementById('user-email');
  const notesList = document.getElementById('notes-list');
  const newNoteBtn = document.getElementById('new-note-btn');
  const noteTitleInput = document.getElementById('note-title');
  const noteContentTextarea = document.getElementById('note-content');
  const saveStatus = document.getElementById('save-status');

  let currentUser = null;
  let currentNotes = [];
  let currentNoteId = null;
  let saveTimeout;

  // Dark mode helper
  function isDarkMode() {
    return document.body.classList.contains('dark');
  }
  function toggleDarkMode() {
    document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', isDarkMode() ? 'true' : 'false');
  }

  // Load dark mode preference
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark');
  }

  toggleDarkBtn.onclick = toggleDarkMode;
  toggleDarkMainBtn.onclick = toggleDarkMode;

  // Show error message on login screen
  function showLoginMessage(msg, color = 'crimson') {
    loginMessage.style.color = color;
    loginMessage.textContent = msg;
  }

  // Clear editor inputs
  function clearEditor() {
    noteTitleInput.value = '';
    noteContentTextarea.value = '';
    saveStatus.textContent = '';
    currentNoteId = null;
  }

  // Render notes sidebar
  function renderNotes() {
    notesList.innerHTML = '';
    if (!currentNotes.length) {
      const noNotes = document.createElement('div');
      noNotes.textContent = 'No notes yet. Click "+ New Note" to create one.';
      noNotes.style.padding = '15px';
      noNotes.style.color = '#666';
      notesList.appendChild(noNotes);
      clearEditor();
      return;
    }
    currentNotes.forEach(note => {
      const div = document.createElement('div');
      div.className = 'note-item';
      div.textContent = note.title || '(Untitled)';
      div.title = note.title || '(Untitled)';
      if (note.id === currentNoteId) {
        div.classList.add('selected');
      }
      div.onclick = () => {
        if (currentNoteId !== note.id) {
          saveCurrentNote(() => loadNote(note.id));
        }
      };
      notesList.appendChild(div);
    });
  }

  // Load a note into editor
  function loadNote(id) {
    const note = currentNotes.find(n => n.id === id);
    if (!note) return;
    currentNoteId = id;
    noteTitleInput.value = note.title || '';
    noteContentTextarea.value = note.content || '';
    renderNotes();
    saveStatus.textContent = '';
  }

  // Save note to Firestore
  async function saveNoteToDB(id, title, content) {
    if (!id) return;
    const userDoc = db.collection('notes').doc(currentUser.uid);
    const notesCollection = userDoc.collection('userNotes');
    await notesCollection.doc(id).set({ title, content, updated: firebase.firestore.FieldValue.serverTimestamp() });
  }

  // Delete note from Firestore
  async function deleteNoteFromDB(id) {
    if (!id) return;
    const userDoc = db.collection('notes').doc(currentUser.uid);
    const notesCollection = userDoc.collection('userNotes');
    await notesCollection.doc(id).delete();
  }

  // Save current note (debounced)
  function saveCurrentNote(callback) {
    clearTimeout(saveTimeout);
    if (!currentNoteId) {
      if (callback) callback();
      return;
    }
    const title = noteTitleInput.value.trim();
    const content = noteContentTextarea.value;
    saveStatus.textContent = 'Saving...';
    saveTimeout = setTimeout(async () => {
      try {
        await saveNoteToDB(currentNoteId, title, content);
        saveStatus.textContent = 'Saved ✓';
        // Update local notes array
        const idx = currentNotes.findIndex(n => n.id === currentNoteId);
        if (idx > -1) {
          currentNotes[idx].title = title;
          currentNotes[idx].content = content;
        }
        renderNotes();
      } catch (e) {
        saveStatus.textContent = 'Error saving note';
        console.error(e);
      }
      if (callback) callback();
    }, 800);
  }

  // Create new note
  async function createNewNote() {
    if (!currentUser) return;
    // Save current note before creating new one
    await new Promise(resolve => saveCurrentNote(resolve));

    const userDoc = db.collection('notes').doc(currentUser.uid);
    const notesCollection = userDoc.collection('userNotes');

    const newNoteRef = notesCollection.doc();
    await newNoteRef.set({
      title: '',
      content: '',
      created: firebase.firestore.FieldValue.serverTimestamp(),
      updated: firebase.firestore.FieldValue.serverTimestamp()
    });

    currentNoteId = newNoteRef.id;
    currentNotes.push({
      id: newNoteRef.id,
      title: '',
      content: ''
    });
    renderNotes();
    loadNote(newNoteRef.id);
  }

  // Load user notes from Firestore
  function loadNotesRealtime() {
    if (!currentUser) return;
    const userDoc = db.collection('notes').doc(currentUser.uid);
    const notesCollection = userDoc.collection('userNotes').orderBy('updated', 'desc');

    notesCollection.onSnapshot(snapshot => {
      currentNotes = [];
      snapshot.forEach(doc => {
        currentNotes.push({ id: doc.id, ...doc.data() });
      });
      // If no current note or deleted current note, load first note
      if (!currentNoteId || !currentNotes.find(n => n.id === currentNoteId)) {
        currentNoteId = currentNotes.length ? currentNotes[0].id : null;
      }
      renderNotes();
      if (currentNoteId) loadNote(currentNoteId);
      else clearEditor();
    });
  }

  // AUTH UI management
  function showLogin(show) {
    loginScreen.style.display = show ? 'flex' : 'none';
    app.style.display = show ? 'none' : 'flex';
  }

  // Clear login inputs
  function clearLoginInputs() {
    emailInput.value = '';
    passwordInput.value = '';
    showLoginMessage('');
  }

  // Log in
  loginBtn.onclick = async () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    if (!email || !password) {
      showLoginMessage('Please enter email and password.');
      return;
    }
    showLoginMessage('Logging in...', '#3b82f6');
    try {
      await auth.signInWithEmailAndPassword(email, password);
    } catch (err) {
      showLoginMessage(err.message || 'Login failed.');
    }
  };

  // Sign up
  signupBtn.onclick = async () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    if (!email || !password) {
      showLoginMessage('Please enter email and password.');
      return;
    }
    if (password.length < 6) {
      showLoginMessage('Password should be at least 6 characters.');
      return;
    }
    showLoginMessage('Signing up...', '#3b82f6');
    try {
      await auth.createUserWithEmailAndPassword(email, password);
    } catch (err) {
      showLoginMessage(err.message || 'Sign up failed.');
    }
  };

  // Password reset
  resetBtn.onclick = async () => {
    const email = emailInput.value.trim();
    if (!email) {
      showLoginMessage('Please enter your email to reset.');
      return;
    }
    try {
      await auth.sendPasswordResetEmail(email);
      showLoginMessage('Password reset email sent.', 'green');
    } catch (err) {
      showLoginMessage(err.message || 'Failed to send reset email.');
    }
  };

  // Logout
  logoutBtn.onclick = () => {
    auth.signOut();
  };

  // Listen for auth state
  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      userEmailDisplay.textContent = user.email;
      showLogin(false);
      loadNotesRealtime();
    } else {
      currentUser = null;
      clearLoginInputs();
      showLogin(true);
      currentNotes = [];
      currentNoteId = null;
      clearEditor();
    }
  });

  // New note button
  newNoteBtn.onclick = createNewNote;

  // Auto-save on title/content change
  noteTitleInput.addEventListener('input', () => saveCurrentNote());
  noteContentTextarea.addEventListener('input', () => saveCurrentNote());
</script>
</body>
</html>
